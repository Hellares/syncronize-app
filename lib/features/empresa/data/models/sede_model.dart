import '../../domain/entities/sede.dart';

class SedeModel extends Sede {
  const SedeModel({
    required super.id,
    required super.empresaId,
    required super.codigo,
    required super.nombre,
    super.telefono,
    super.email,
    required super.tipoSede,
    super.direccion,
    super.referencia,
    super.distrito,
    super.provincia,
    super.departamento,
    super.pais,
    super.coordenadas,
    super.horarioAtencion,
    super.configuracion,
    required super.serieFactura,
    required super.serieBoleta,
    required super.serieNotaCredito,
    required super.serieNotaDebito,
    super.serieGuiaRemision,
    required super.ultimoNumeroFactura,
    required super.ultimoNumeroBoleta,
    required super.ultimoNumeroNotaCredito,
    required super.ultimoNumeroNotaDebito,
    required super.ultimoNumeroGuiaRemision,
    required super.isActive,
    super.deletedAt,
    required super.esPrincipal,
    required super.creadoEn,
    required super.actualizadoEn,
    super.userRole,
    super.totalUsuarios,
    super.totalProductos,
    super.totalServicios,
  });

  factory SedeModel.fromJson(Map<String, dynamic> json) {
    return SedeModel(
      id: json['id'] as String,
      empresaId: json['empresaId'] as String,
      codigo: json['codigo'] as String,
      nombre: json['nombre'] as String,
      telefono: json['telefono'] as String?,
      email: json['email'] as String?,
      tipoSede: TipoSede.fromString(json['tipoSede'] as String? ?? 'OPERATIVA_COMPLETA'),
      direccion: json['direccion'] as String?,
      referencia: json['referencia'] as String?,
      distrito: json['distrito'] as String?,
      provincia: json['provincia'] as String?,
      departamento: json['departamento'] as String?,
      pais: json['pais'] as String?,
      coordenadas: json['coordenadas'] as Map<String, dynamic>?,
      horarioAtencion: json['horarioAtencion'] as Map<String, dynamic>?,
      configuracion: json['configuracion'] as Map<String, dynamic>?,
      serieFactura: json['serieFactura'] as String? ?? 'F001',
      serieBoleta: json['serieBoleta'] as String? ?? 'B001',
      serieNotaCredito: json['serieNotaCredito'] as String? ?? 'NC01',
      serieNotaDebito: json['serieNotaDebito'] as String? ?? 'ND01',
      serieGuiaRemision: json['serieGuiaRemision'] as String?,
      ultimoNumeroFactura: json['ultimoNumeroFactura'] as int? ?? 0,
      ultimoNumeroBoleta: json['ultimoNumeroBoleta'] as int? ?? 0,
      ultimoNumeroNotaCredito: json['ultimoNumeroNotaCredito'] as int? ?? 0,
      ultimoNumeroNotaDebito: json['ultimoNumeroNotaDebito'] as int? ?? 0,
      ultimoNumeroGuiaRemision: json['ultimoNumeroGuiaRemision'] as int? ?? 0,
      isActive: json['isActive'] as bool? ?? true,
      deletedAt: json['deletedAt'] != null ? DateTime.parse(json['deletedAt'] as String) : null,
      esPrincipal: json['esPrincipal'] as bool? ?? false,
      creadoEn: DateTime.parse(json['creadoEn'] as String),
      actualizadoEn: DateTime.parse(json['actualizadoEn'] as String),
      userRole: json['userRole'] as String?,
      totalUsuarios: json['totalUsuarios'] as int?,
      totalProductos: json['totalProductos'] as int?,
      totalServicios: json['totalServicios'] as int?,
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'empresaId': empresaId,
      'codigo': codigo,
      'nombre': nombre,
      if (telefono != null) 'telefono': telefono,
      if (email != null) 'email': email,
      'tipoSede': tipoSede.value,
      if (direccion != null) 'direccion': direccion,
      if (referencia != null) 'referencia': referencia,
      if (distrito != null) 'distrito': distrito,
      if (provincia != null) 'provincia': provincia,
      if (departamento != null) 'departamento': departamento,
      if (pais != null) 'pais': pais,
      if (coordenadas != null) 'coordenadas': coordenadas,
      if (horarioAtencion != null) 'horarioAtencion': horarioAtencion,
      if (configuracion != null) 'configuracion': configuracion,
      'serieFactura': serieFactura,
      'serieBoleta': serieBoleta,
      'serieNotaCredito': serieNotaCredito,
      'serieNotaDebito': serieNotaDebito,
      if (serieGuiaRemision != null) 'serieGuiaRemision': serieGuiaRemision,
      'ultimoNumeroFactura': ultimoNumeroFactura,
      'ultimoNumeroBoleta': ultimoNumeroBoleta,
      'ultimoNumeroNotaCredito': ultimoNumeroNotaCredito,
      'ultimoNumeroNotaDebito': ultimoNumeroNotaDebito,
      'ultimoNumeroGuiaRemision': ultimoNumeroGuiaRemision,
      'isActive': isActive,
      if (deletedAt != null) 'deletedAt': deletedAt!.toIso8601String(),
      'esPrincipal': esPrincipal,
      'creadoEn': creadoEn.toIso8601String(),
      'actualizadoEn': actualizadoEn.toIso8601String(),
      if (userRole != null) 'userRole': userRole,
      if (totalUsuarios != null) 'totalUsuarios': totalUsuarios,
      if (totalProductos != null) 'totalProductos': totalProductos,
      if (totalServicios != null) 'totalServicios': totalServicios,
    };
  }

  Sede toEntity() => this;

  factory SedeModel.fromEntity(Sede entity) {
    return SedeModel(
      id: entity.id,
      empresaId: entity.empresaId,
      codigo: entity.codigo,
      nombre: entity.nombre,
      telefono: entity.telefono,
      email: entity.email,
      tipoSede: entity.tipoSede,
      direccion: entity.direccion,
      referencia: entity.referencia,
      distrito: entity.distrito,
      provincia: entity.provincia,
      departamento: entity.departamento,
      pais: entity.pais,
      coordenadas: entity.coordenadas,
      horarioAtencion: entity.horarioAtencion,
      configuracion: entity.configuracion,
      serieFactura: entity.serieFactura,
      serieBoleta: entity.serieBoleta,
      serieNotaCredito: entity.serieNotaCredito,
      serieNotaDebito: entity.serieNotaDebito,
      serieGuiaRemision: entity.serieGuiaRemision,
      ultimoNumeroFactura: entity.ultimoNumeroFactura,
      ultimoNumeroBoleta: entity.ultimoNumeroBoleta,
      ultimoNumeroNotaCredito: entity.ultimoNumeroNotaCredito,
      ultimoNumeroNotaDebito: entity.ultimoNumeroNotaDebito,
      ultimoNumeroGuiaRemision: entity.ultimoNumeroGuiaRemision,
      isActive: entity.isActive,
      deletedAt: entity.deletedAt,
      esPrincipal: entity.esPrincipal,
      creadoEn: entity.creadoEn,
      actualizadoEn: entity.actualizadoEn,
      userRole: entity.userRole,
      totalUsuarios: entity.totalUsuarios,
      totalProductos: entity.totalProductos,
      totalServicios: entity.totalServicios,
    );
  }

  /// Crea un modelo para crear una nueva sede (payload para POST)
  Map<String, dynamic> toCreateJson() {
    return {
      'nombre': nombre,
      if (codigo.isNotEmpty) 'codigo': codigo,
      if (telefono != null && telefono!.isNotEmpty) 'telefono': telefono,
      if (email != null && email!.isNotEmpty) 'email': email,
      'tipoSede': tipoSede.value,
      if (direccion != null && direccion!.isNotEmpty) 'direccion': direccion,
      if (referencia != null && referencia!.isNotEmpty) 'referencia': referencia,
      if (distrito != null && distrito!.isNotEmpty) 'distrito': distrito,
      if (provincia != null && provincia!.isNotEmpty) 'provincia': provincia,
      if (departamento != null && departamento!.isNotEmpty) 'departamento': departamento,
      if (pais != null && pais!.isNotEmpty) 'pais': pais,
      if (coordenadas != null) 'coordenadas': coordenadas,
      if (horarioAtencion != null) 'horarioAtencion': horarioAtencion,
      if (configuracion != null) 'configuracion': configuracion,
      if (serieFactura.isNotEmpty) 'serieFactura': serieFactura,
      if (serieBoleta.isNotEmpty) 'serieBoleta': serieBoleta,
      if (serieNotaCredito.isNotEmpty) 'serieNotaCredito': serieNotaCredito,
      if (serieNotaDebito.isNotEmpty) 'serieNotaDebito': serieNotaDebito,
      if (serieGuiaRemision != null && serieGuiaRemision!.isNotEmpty)
        'serieGuiaRemision': serieGuiaRemision,
      'isActive': isActive,
    };
  }

  /// Crea un modelo para actualizar una sede (payload para PUT)
  Map<String, dynamic> toUpdateJson() {
    return toCreateJson(); // Por ahora son iguales
  }
}
